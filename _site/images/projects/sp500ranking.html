<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>sp500ranking</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>

    <!-- Custom stylesheet, it must be in the same directory as the html file -->
    <link rel="stylesheet" href="custom.css">

    <!-- Load mathjax -->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML-full,Safe"> </script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: {
                    automatic: true
                    }
                }
            });

            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    <!-- End of mathjax configuration -->
</head>

<body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">

    <div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">
                </div>
                <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput "
                    data-mime-type="text/markdown">
                    <h1 id="S&amp;P-500-Ranking-Project">S&amp;P 500 Screener Project<a class="anchor-link"
                            href="#S&amp;P-500-Ranking-Project">&#182;</a></h1>
                    <h2 id="Python,-SQL-and-Tableau:-Linear-Regression,-Key-Metrics,-Dashboard">Python: ETL of S&P500
                        financials<a class="anchor-link"
                            href="#Python,-SQL-and-Tableau:-Linear-Regression,-Key-Metrics,-Dashboard">&#182;</a></h2>
                    <ul>
                        <li>Data Source: Yahoo Finance</li>
                        <li>Import Tool: Yfinance</li>
                        <li>Export Option: SQL database</li>
                        <li>Data Transformations: drop /edit cols, create features for regression analysis</li>
                        <li>Future changes: Add portfolio risk analysis, Agg. economic health indicators</li>
                    </ul>

                </div>
            </div>
        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[2]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">notebook</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[3]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="c1"># Set current directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'/home/jovyan/work'</span><span class="p">)</span>

<span class="c1"># Pandas settings</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">"display.max_columns"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># Constants</span>
<span class="n">tickers_url</span> <span class="o">=</span> <span class="s2">"https://en.wikipedia.org/wiki/List_of_S%26P_500_companies"</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[4]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="c1"># Fetch S&amp;P 500 ticker list</span>
<span class="k">def</span> <span class="nf">read_tickers</span><span class="p">():</span>    
    <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tickers_url</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">'html.parser'</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"table"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"class"</span><span class="p">:</span> <span class="s2">"wikitable sortable"</span><span class="p">})</span>
    
    <span class="c1"># Fail now if we haven't found the right table</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s2">"th"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">"Symbol"</span> <span class="ow">or</span> <span class="n">header</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">string</span> <span class="o">!=</span> <span class="s2">"Security"</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Can't parse Wikipedia's table!"</span><span class="p">)</span>
    
    <span class="n">ticker_arr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s2">"tr"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s2">"td"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">ticker</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="s1">'-'</span><span class="p">)</span>
            <span class="n">ticker_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

    <span class="n">ticker_str</span> <span class="o">=</span> <span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ticker_arr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ticker_str</span><span class="p">,</span> <span class="n">ticker_arr</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[4]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="c1"># read tickers and init yahoo finance scraper</span>
<span class="n">tickers</span><span class="p">,</span> <span class="n">ticker_arr</span> <span class="o">=</span> <span class="n">read_tickers</span><span class="p">()</span>
<span class="n">sp500</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Tickers</span><span class="p">(</span><span class="n">tickers</span><span class="p">)</span>

<span class="n">ticker_range</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ticker_arr</span><span class="p">))</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[5]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="c1"># Extract</span>

<span class="k">def</span> <span class="nf">extract_info</span><span class="p">(</span><span class="n">yfd</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">notebook</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ticker_range</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">ticker_range</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">yfd</span><span class="o">.</span><span class="n">tickers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ticker_arr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">info</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">max_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">partial</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Load company info data successful'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">transform_helper</span><span class="p">(</span><span class="n">partial</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">T</span><span class="p">:</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="n">partial</span><span class="o">.</span><span class="n">T</span>
    <span class="n">partial</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">partial</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Date'</span><span class="p">,</span> <span class="o">*</span><span class="n">partial</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="n">partial</span><span class="p">[</span><span class="s1">'Ticker'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticker_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">partial</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">partial</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">partial</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">partial</span>

<span class="k">def</span> <span class="nf">get_income</span><span class="p">(</span><span class="n">yfd</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">notebook</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ticker_range</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">ticker_range</span><span class="p">):</span>
        <span class="n">org</span> <span class="o">=</span> <span class="n">yfd</span><span class="o">.</span><span class="n">tickers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ticker_arr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">financials</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="n">transform_helper</span><span class="p">(</span><span class="n">org</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">i</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">partial</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Load company income statement data successful'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">get_balance_sheet</span><span class="p">(</span><span class="n">yfd</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">notebook</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ticker_range</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">ticker_range</span><span class="p">):</span>
        <span class="n">org</span> <span class="o">=</span> <span class="n">yfd</span><span class="o">.</span><span class="n">tickers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ticker_arr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">balance_sheet</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="n">transform_helper</span><span class="p">(</span><span class="n">org</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">i</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">partial</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Load company balance sheet data successful'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">get_cash_flow</span><span class="p">(</span><span class="n">yfd</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">notebook</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ticker_range</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">ticker_range</span><span class="p">):</span>
        <span class="n">org</span> <span class="o">=</span> <span class="n">yfd</span><span class="o">.</span><span class="n">tickers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ticker_arr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">cashflow</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="n">transform_helper</span><span class="p">(</span><span class="n">org</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">i</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">partial</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Load company cashflow statement data successful'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">extract_financials</span><span class="p">(</span><span class="n">yfd</span><span class="p">):</span>
    <span class="n">df_pnl</span> <span class="o">=</span> <span class="n">get_income</span><span class="p">(</span><span class="n">yfd</span><span class="p">)</span>
    <span class="n">df_bs</span> <span class="o">=</span> <span class="n">get_balance_sheet</span><span class="p">(</span><span class="n">yfd</span><span class="p">)</span>
    <span class="n">df_cf</span> <span class="o">=</span> <span class="n">get_cash_flow</span><span class="p">(</span><span class="n">yfd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_pnl</span><span class="p">,</span> <span class="n">df_bs</span><span class="p">,</span> <span class="n">df_cf</span>

<span class="k">def</span> <span class="nf">extract_recommendations</span><span class="p">(</span><span class="n">yfd</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">notebook</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ticker_range</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">ticker_range</span><span class="p">):</span>
        <span class="n">org</span> <span class="o">=</span> <span class="n">yfd</span><span class="o">.</span><span class="n">tickers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ticker_arr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">recommendations</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="n">transform_helper</span><span class="p">(</span><span class="n">org</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">i</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">twoQs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">'today'</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">[</span><span class="n">partial</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">twoQs</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">partial</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Load company recommendation data successful'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

   
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[6]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">extract_info</span><span class="p">(</span><span class="n">sp500</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="jp-Cell-outputWrapper">
            <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
            </div>


            <div class="jp-OutputArea jp-Cell-outputArea">
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




                    <div class="jp-RenderedText jp-OutputArea-output " data-mime-type="text/plain">
                        <pre>  0%|          | 0/502 [00:00&lt;?, ?it/s]</pre>
                    </div>

                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Load company info data successful
</pre>
                    </div>
                </div>

            </div>

        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[7]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="n">df2</span><span class="p">,</span> <span class="n">df3</span><span class="p">,</span> <span class="n">df4</span> <span class="o">=</span> <span class="n">extract_financials</span><span class="p">(</span><span class="n">sp500</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="jp-Cell-outputWrapper">
            <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
            </div>


            <div class="jp-OutputArea jp-Cell-outputArea">
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




                    <div class="jp-RenderedText jp-OutputArea-output " data-mime-type="text/plain">
                        <pre>  0%|          | 0/502 [00:00&lt;?, ?it/s]</pre>
                    </div>

                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Load company income statement data successful
</pre>
                    </div>
                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




                    <div class="jp-RenderedText jp-OutputArea-output " data-mime-type="text/plain">
                        <pre>  0%|          | 0/502 [00:00&lt;?, ?it/s]</pre>
                    </div>

                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Load company balance sheet data successful
</pre>
                    </div>
                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




                    <div class="jp-RenderedText jp-OutputArea-output " data-mime-type="text/plain">
                        <pre>  0%|          | 0/502 [00:00&lt;?, ?it/s]</pre>
                    </div>

                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Load company cashflow statement data successful
</pre>
                    </div>
                </div>

            </div>

        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[8]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="n">df5</span> <span class="o">=</span> <span class="n">extract_recommendations</span><span class="p">(</span><span class="n">sp500</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="jp-Cell-outputWrapper">
            <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
            </div>


            <div class="jp-OutputArea jp-Cell-outputArea">
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




                    <div class="jp-RenderedText jp-OutputArea-output " data-mime-type="text/plain">
                        <pre>  0%|          | 0/502 [00:00&lt;?, ?it/s]</pre>
                    </div>

                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Load company recommendation data successful
</pre>
                    </div>
                </div>

            </div>

        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[10]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="c1"># Transform</span>

<span class="c1"># drop empty or unecessary cols</span>
<span class="n">null_cols</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span><span class="mi">500</span>
<span class="n">drop_cols</span> <span class="o">=</span> <span class="n">null_cols</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
<span class="n">df1</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drop_cols</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df1</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'maxAge'</span><span class="p">,</span><span class="s1">'fax'</span><span class="p">,</span><span class="s1">'quoteType'</span><span class="p">,</span>
                  <span class="c1"># '52WeekChange', 'SandP52WeekChange', 'impliedSharesOutstanding', 'trailingPegRatio'</span>
                 <span class="s1">'tradeable'</span><span class="p">,</span><span class="s1">'address2'</span><span class="p">,</span><span class="s1">'companyOfficers'</span><span class="p">,</span><span class="s1">'priceHint'</span><span class="p">,</span>
                 <span class="s1">'financialCurrency'</span><span class="p">,</span><span class="s1">'exchangeTimezoneName'</span><span class="p">,</span><span class="s1">'exchangeTimezoneShortName'</span><span class="p">,</span>
                 <span class="s1">'market'</span><span class="p">,</span><span class="s1">'uuid'</span><span class="p">,</span><span class="s1">'targetLowPrice'</span><span class="p">,</span><span class="s1">'recommendationKey'</span><span class="p">,</span><span class="s1">'targetMedianPrice'</span><span class="p">,</span>
                 <span class="s1">'numberOfAnalystOpinions'</span><span class="p">,</span><span class="s1">'targetMeanPrice'</span><span class="p">,</span><span class="s1">'targetHighPrice'</span><span class="p">,</span><span class="s1">'recommendationMean'</span><span class="p">,</span>
                 <span class="s1">'gmtOffSetMilliseconds'</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"df1 cleaning successful"</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="jp-Cell-outputWrapper">
            <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
            </div>


            <div class="jp-OutputArea jp-Cell-outputArea">
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>df1 cleaning successful
</pre>
                    </div>
                </div>

            </div>

        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[12]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="c1"># run any test now</span>
<span class="n">redo_arr</span> <span class="o">=</span> <span class="n">df4</span><span class="p">[</span><span class="n">df4</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()][</span><span class="s1">'Ticker'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">redo_arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">redo</span> <span class="o">=</span> <span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">redo_arr</span><span class="p">)</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Tickers</span><span class="p">(</span><span class="n">redo</span><span class="p">)</span>
    <span class="n">ticker_arr</span> <span class="o">=</span> <span class="n">redo_arr</span>
    <span class="n">ticker_range</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">redo_arr</span><span class="p">))</span>
    
    <span class="n">df2r</span><span class="p">,</span> <span class="n">df3r</span><span class="p">,</span> <span class="n">df4r</span> <span class="o">=</span> <span class="n">extract_financials</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
    
    <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="p">[</span><span class="s1">'Ticker'</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">redo_arr</span><span class="p">)]</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df2</span><span class="p">,</span><span class="n">df2r</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df3</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[</span><span class="n">df3</span><span class="p">[</span><span class="s1">'Ticker'</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">redo_arr</span><span class="p">)]</span>
    <span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df3</span><span class="p">,</span><span class="n">df3r</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df4</span> <span class="o">=</span> <span class="n">df4</span><span class="p">[</span><span class="n">df4</span><span class="p">[</span><span class="s1">'Ticker'</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">redo_arr</span><span class="p">)]</span>
    <span class="n">df4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df4</span><span class="p">,</span><span class="n">df4r</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="jp-Cell-outputWrapper">
            <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
            </div>


            <div class="jp-OutputArea jp-Cell-outputArea">
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




                    <div class="jp-RenderedText jp-OutputArea-output " data-mime-type="text/plain">
                        <pre>  0%|          | 0/4 [00:00&lt;?, ?it/s]</pre>
                    </div>

                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Load company income statement data successful
</pre>
                    </div>
                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




                    <div class="jp-RenderedText jp-OutputArea-output " data-mime-type="text/plain">
                        <pre>  0%|          | 0/4 [00:00&lt;?, ?it/s]</pre>
                    </div>

                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Load company balance sheet data successful
</pre>
                    </div>
                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




                    <div class="jp-RenderedText jp-OutputArea-output " data-mime-type="text/plain">
                        <pre>  0%|          | 0/4 [00:00&lt;?, ?it/s]</pre>
                    </div>

                </div>
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Load company cashflow statement data successful
</pre>
                    </div>
                </div>

            </div>

        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[17]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="c1"># Last check before sql import</span>
<span class="n">m1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()][</span><span class="s1">'Ticker'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="n">m2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df3</span><span class="p">[</span><span class="n">df3</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()][</span><span class="s1">'Ticker'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="n">m3</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df4</span><span class="p">[</span><span class="n">df4</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()][</span><span class="s1">'Ticker'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="n">m4</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df5</span><span class="p">[</span><span class="s1">'Ticker'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticker_arr</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">m2</span><span class="o">+</span><span class="n">m3</span><span class="o">+</span><span class="n">m4</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Dataset is complete'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Dataset is not complete'</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="jp-Cell-outputWrapper">
            <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
            </div>


            <div class="jp-OutputArea jp-Cell-outputArea">
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Dataset is complete
</pre>
                    </div>
                </div>

            </div>

        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[22]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">'postgresql://postgres:headband@192.168.0.151:5432/mydb'</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[23]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="c1"># Load</span>
<span class="k">def</span> <span class="nf">update_server</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span><span class="n">dataframe</span><span class="p">):</span>  
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span><span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">if_exists</span><span class="o">=</span><span class="s1">'replace'</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Successfully imported </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1"> to server'</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Got an error while updating server'</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Error: '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
            </div>
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[24]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">df3</span><span class="p">,</span><span class="n">df4</span><span class="p">,</span><span class="n">df5</span><span class="p">]</span>
<span class="n">sql_tables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Info"</span><span class="p">,</span><span class="s2">"Income"</span><span class="p">,</span><span class="s2">"BalanceSheet"</span><span class="p">,</span><span class="s2">"CashFlow"</span><span class="p">,</span><span class="s2">"Recommendation"</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)):</span>
    <span class="n">update_server</span><span class="p">(</span><span class="sa">f</span><span class="s2">"SP500</span><span class="si">{</span><span class="n">sql_tables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span><span class="n">dfs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="jp-Cell-outputWrapper">
            <div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
            </div>


            <div class="jp-OutputArea jp-Cell-outputArea">
                <div class="jp-OutputArea-child">

                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Successfully imported SP500Info to server
Successfully imported SP500Income to server
Successfully imported SP500BalanceSheet to server
Successfully imported SP500CashFlow to server
Successfully imported SP500Recommendation to server
</pre>
                    </div>
                </div>

            </div>

        </div>

    </div>
</body>







</html>