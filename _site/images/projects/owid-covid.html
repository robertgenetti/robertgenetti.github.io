<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>owid-covid</title><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<!-- Custom stylesheet, it must be in the same directory as the html file -->
<link rel="stylesheet" href="custom.css">

<!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML-full,Safe"> </script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: {
                    automatic: true
                    }
                }
            });

            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    <!-- End of mathjax configuration --></head>
<body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Covid-19-Dashboard-Project">Covid-19 Dashboard Project<a class="anchor-link" href="#Covid-19-Dashboard-Project">&#182;</a></h1><h2 id="Python,-SQL-and-Tableau:-Data-Extraction,-Key-Metrics,-Dashboard">Python, SQL and Tableau: Data Extraction, Key Metrics, Dashboard<a class="anchor-link" href="#Python,-SQL-and-Tableau:-Data-Extraction,-Key-Metrics,-Dashboard">&#182;</a></h2><ul>
<li>Data Source: Our World In Data</li>
<li>Dataset: Covid-19</li>
<li>Export Option: SQL database</li>
<li>Data Transformations: format data types (string, datetime, float)</li>
<li>Future changes: Fill in NA values in agg. columns with cummulative values</li>
</ul>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[1]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># imports</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">timedelta</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[2]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Setup</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'/home/jovyan/work'</span><span class="p">)</span>

<span class="n">uri</span> <span class="o">=</span> <span class="s1">'https://github.com/owid/covid-19-data/blob/master/public/data/owid-covid-data.csv?raw=true'</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[3]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># check if last updated is 24 hrs old</span>
<span class="k">def</span> <span class="nf">is24hr_old</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="sa">f</span><span class="s1">'data/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.csv'</span><span class="p">)</span>
    <span class="n">org</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
    <span class="n">is_old</span> <span class="o">=</span> <span class="n">org</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">is_old</span>

<span class="c1"># Cache dataset to local csv and refresh if older than 1 day</span>
<span class="k">def</span> <span class="nf">refresh_data</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">if</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.csv'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">'data'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is24hr_old</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">'data/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.csv'</span><span class="p">)</span>    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">'data/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.csv'</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[4]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">refresh_data</span><span class="p">(</span><span class="s1">'owid-covid'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[4]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>Index([&#39;iso_code&#39;, &#39;continent&#39;, &#39;location&#39;, &#39;date&#39;, &#39;total_cases&#39;, &#39;new_cases&#39;,
       &#39;new_cases_smoothed&#39;, &#39;total_deaths&#39;, &#39;new_deaths&#39;,
       &#39;new_deaths_smoothed&#39;, &#39;total_cases_per_million&#39;,
       &#39;new_cases_per_million&#39;, &#39;new_cases_smoothed_per_million&#39;,
       &#39;total_deaths_per_million&#39;, &#39;new_deaths_per_million&#39;,
       &#39;new_deaths_smoothed_per_million&#39;, &#39;reproduction_rate&#39;, &#39;icu_patients&#39;,
       &#39;icu_patients_per_million&#39;, &#39;hosp_patients&#39;,
       &#39;hosp_patients_per_million&#39;, &#39;weekly_icu_admissions&#39;,
       &#39;weekly_icu_admissions_per_million&#39;, &#39;weekly_hosp_admissions&#39;,
       &#39;weekly_hosp_admissions_per_million&#39;, &#39;total_tests&#39;, &#39;new_tests&#39;,
       &#39;total_tests_per_thousand&#39;, &#39;new_tests_per_thousand&#39;,
       &#39;new_tests_smoothed&#39;, &#39;new_tests_smoothed_per_thousand&#39;,
       &#39;positive_rate&#39;, &#39;tests_per_case&#39;, &#39;tests_units&#39;, &#39;total_vaccinations&#39;,
       &#39;people_vaccinated&#39;, &#39;people_fully_vaccinated&#39;, &#39;total_boosters&#39;,
       &#39;new_vaccinations&#39;, &#39;new_vaccinations_smoothed&#39;,
       &#39;total_vaccinations_per_hundred&#39;, &#39;people_vaccinated_per_hundred&#39;,
       &#39;people_fully_vaccinated_per_hundred&#39;, &#39;total_boosters_per_hundred&#39;,
       &#39;new_vaccinations_smoothed_per_million&#39;,
       &#39;new_people_vaccinated_smoothed&#39;,
       &#39;new_people_vaccinated_smoothed_per_hundred&#39;, &#39;stringency_index&#39;,
       &#39;population&#39;, &#39;population_density&#39;, &#39;median_age&#39;, &#39;aged_65_older&#39;,
       &#39;aged_70_older&#39;, &#39;gdp_per_capita&#39;, &#39;extreme_poverty&#39;,
       &#39;cardiovasc_death_rate&#39;, &#39;diabetes_prevalence&#39;, &#39;female_smokers&#39;,
       &#39;male_smokers&#39;, &#39;handwashing_facilities&#39;, &#39;hospital_beds_per_thousand&#39;,
       &#39;life_expectancy&#39;, &#39;human_development_index&#39;,
       &#39;excess_mortality_cumulative_absolute&#39;, &#39;excess_mortality_cumulative&#39;,
       &#39;excess_mortality&#39;, &#39;excess_mortality_cumulative_per_million&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[6]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># transformation</span>
<span class="n">dft</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dft</span><span class="o">.</span><span class="n">iso_code</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iso_code</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'string'</span><span class="p">)</span>
<span class="n">dft</span><span class="o">.</span><span class="n">continent</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">continent</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'string'</span><span class="p">)</span>
<span class="n">dft</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'string'</span><span class="p">)</span>
<span class="n">dft</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dft</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<span class="n">dft</span><span class="o">.</span><span class="n">tests_units</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">tests_units</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'string'</span><span class="p">)</span>
<span class="n">dft</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 216578 entries, 0 to 216577
Data columns (total 67 columns):
 #   Column                                      Non-Null Count   Dtype         
---  ------                                      --------------   -----         
 0   iso_code                                    216578 non-null  string        
 1   continent                                   204113 non-null  string        
 2   location                                    216578 non-null  string        
 3   date                                        216578 non-null  datetime64[ns]
 4   total_cases                                 216578 non-null  float64       
 5   new_cases                                   216578 non-null  float64       
 6   new_cases_smoothed                          216578 non-null  float64       
 7   total_deaths                                216578 non-null  float64       
 8   new_deaths                                  216578 non-null  float64       
 9   new_deaths_smoothed                         216578 non-null  float64       
 10  total_cases_per_million                     216578 non-null  float64       
 11  new_cases_per_million                       216578 non-null  float64       
 12  new_cases_smoothed_per_million              216578 non-null  float64       
 13  total_deaths_per_million                    216578 non-null  float64       
 14  new_deaths_per_million                      216578 non-null  float64       
 15  new_deaths_smoothed_per_million             216578 non-null  float64       
 16  reproduction_rate                           216578 non-null  float64       
 17  icu_patients                                216578 non-null  float64       
 18  icu_patients_per_million                    216578 non-null  float64       
 19  hosp_patients                               216578 non-null  float64       
 20  hosp_patients_per_million                   216578 non-null  float64       
 21  weekly_icu_admissions                       216578 non-null  float64       
 22  weekly_icu_admissions_per_million           216578 non-null  float64       
 23  weekly_hosp_admissions                      216578 non-null  float64       
 24  weekly_hosp_admissions_per_million          216578 non-null  float64       
 25  total_tests                                 216578 non-null  float64       
 26  new_tests                                   216578 non-null  float64       
 27  total_tests_per_thousand                    216578 non-null  float64       
 28  new_tests_per_thousand                      216578 non-null  float64       
 29  new_tests_smoothed                          216578 non-null  float64       
 30  new_tests_smoothed_per_thousand             216578 non-null  float64       
 31  positive_rate                               216578 non-null  float64       
 32  tests_per_case                              216578 non-null  float64       
 33  tests_units                                 106788 non-null  string        
 34  total_vaccinations                          216578 non-null  float64       
 35  people_vaccinated                           216578 non-null  float64       
 36  people_fully_vaccinated                     216578 non-null  float64       
 37  total_boosters                              216578 non-null  float64       
 38  new_vaccinations                            216578 non-null  float64       
 39  new_vaccinations_smoothed                   216578 non-null  float64       
 40  total_vaccinations_per_hundred              216578 non-null  float64       
 41  people_vaccinated_per_hundred               216578 non-null  float64       
 42  people_fully_vaccinated_per_hundred         216578 non-null  float64       
 43  total_boosters_per_hundred                  216578 non-null  float64       
 44  new_vaccinations_smoothed_per_million       216578 non-null  float64       
 45  new_people_vaccinated_smoothed              216578 non-null  float64       
 46  new_people_vaccinated_smoothed_per_hundred  216578 non-null  float64       
 47  stringency_index                            216578 non-null  float64       
 48  population                                  216578 non-null  float64       
 49  population_density                          216578 non-null  float64       
 50  median_age                                  216578 non-null  float64       
 51  aged_65_older                               216578 non-null  float64       
 52  aged_70_older                               216578 non-null  float64       
 53  gdp_per_capita                              216578 non-null  float64       
 54  extreme_poverty                             216578 non-null  float64       
 55  cardiovasc_death_rate                       216578 non-null  float64       
 56  diabetes_prevalence                         216578 non-null  float64       
 57  female_smokers                              216578 non-null  float64       
 58  male_smokers                                216578 non-null  float64       
 59  handwashing_facilities                      216578 non-null  float64       
 60  hospital_beds_per_thousand                  216578 non-null  float64       
 61  life_expectancy                             216578 non-null  float64       
 62  human_development_index                     216578 non-null  float64       
 63  excess_mortality_cumulative_absolute        216578 non-null  float64       
 64  excess_mortality_cumulative                 216578 non-null  float64       
 65  excess_mortality                            216578 non-null  float64       
 66  excess_mortality_cumulative_per_million     216578 non-null  float64       
dtypes: datetime64[ns](1), float64(62), string(4)
memory usage: 110.7 MB
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[11]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">'postgresql://postgres:headband@192.168.0.151:5432/mydb'</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[13]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">update_server</span><span class="p">(</span><span class="n">table_name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dft</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span><span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">if_exists</span><span class="o">=</span><span class="s1">'replace'</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Successfully updated server'</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Got an error while updating server'</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[14]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">update_server</span><span class="p">(</span><span class="s1">'owid_covid'</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
</body>







</html>
